# Микросервис полнотекстового поиска

### Описание
Микросервис - асинхронное API, написанное на FastAPI, для полнотекстового поиска данных в хранилище ElasticSearch. Все эндпоинты API покрыты асинхронными тестами (pytest, pytest-asyncio). В самом микросервисе API хранилище ElasticSearch пустое (для его заполнения требуется другой микросервис). Тесты API работают с отдельным тестовым контейнером хранилища ElasticSearch, в которое через фикстуры вводится массив тестовых данных.
Автор: Аюпов Ильдар, 2023 г., ildarbon@gmail.com
Основные технологии и библиотеки:
- FastAPI
- ElasticSearch
- Redis
- pydantic
- Docker
- asyncio
- Pytest
- Pytest-asyncio
- aiohttp

### Инструкция по запуску API
- клонировать настоящий репозиторий
- в папке ```fastapi``` переименовать файл ```.env.example``` в ```.env``` (все настройки рабочие; ничего менять не нужно)
- в папке ```fastapi``` выполнить команду ```docker compose up```. Отобразится процесс сборки контейнеров, после чего API заработает.
- после сборки контейнеров эндпоинты API доступны по адресам: ```127.0.0.1:8000/api/v1/...```
- подробное описание API доступно по адресу ```127.0.0.1:8000/api/openapi```

### Инструкция по запуску тестов в docker compose: ###
- перейти в папку ```tests/functional``` 
- переименовать файл ```.env.example``` в ```.env``` (все настройки рабочие; ничего менять не нужно)
- выполнить команду ```docker compose up```. Отобразится процесс сборки контейнеров и ход выполнения тестов, после чего произойдет выход.

### Инструкция по запуску тестов локально (elastic, redis и api запускаются в docker compose): ###
- корректная работа кода гарантирована в Python 3.10.6
- перейти в папку ```tests/functional``` 
- переименовать файл ```.env.example``` в ```.env```. В указанном файле настроек установить ```TESTS_RUN_LOCALLY=true``` (остальные настройки рабочие; больше ничего менять не нужно)
- последовательно выполнить команды:
```
python -m venv venv
venv/scripts/activate
python -m pip install -r requirements.txt

docker-compose -f docker-compose.localtests.yml up -d

cd utils
python wait_for_es.py
python wait_for_redis.py
cd ..

cd src
pytest .
deactivate
```
